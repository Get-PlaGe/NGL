@()

@import views.html.helper._

<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title">@Messages("experiment.addComment")</h4>
      </div>
      <div class="modal-body">
      	<form>
        	<label>@Messages("experiment.leaveComment")</label>
			<textarea  class="form-control" ng-model="experiment.comment" ></textarea>
		
		</form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-default" data-dismiss="modal" aria-hidden="true">@Messages("experiment.cancelComment")</button>
		<button data-dismiss="modal" class="btn btn-primary" ng-disabled="!experiment.experimentInformation.enabled" ng-click="experiment.comments.save();">@Messages("experiment.sendComment")</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->




<div class="row">
<div class="col-md-12 col-lg-12 ">
	<div class="page-header">
	<div class="btn-toolbar pull-right">
			<button class="btn btn-default" ng-show="experiment.value.state.code == 'N'" ng-disabled="experiment.value._id == null || !experiment.experimentInformation.enabled" ng-click="saveAllAndChangeState()" >@Messages("experiments.begin_progress")</button>
			<button  class="btn btn-default"  ng-show="experiment.value.state.code == 'IP'" ng-disabled="experiment.value._id == null || !experiment.experimentInformation.enabled" ng-click="saveAllAndChangeState()" >@Messages("experiments.finish")</button>
		<div class="btn-group " id="experiment_action">
			<a class="btn btn-default dropdown-toggle" data-toggle="dropdown"> Actions <span
				class="caret"></span>
			</a>
			<ul class="dropdown-menu dropdown-menu-right">
				<li><a href="#" ng-disabled="experiment.value.stateCode != 'IP' || !experiment.experimentInformation.enabled"  ng-click="generateSampleSheet()" >@Messages("experiments.sampleSheet")</a></li>
			</ul>
		</div>
		<button class="btn btn-primary" ng-disabled="saveInProgress == true" ng-click="saveAllPromise();" data-toggle="tooltip" title="@Messages("experiments.save_all")">
			<i class="fa fa-save"></i>
		</button>
		<button class="btn btn-default"  data-toggle="modal" data-target="#myModal">@Messages("experiment.addComment")</button>
		
										
	</div>
	<h1>{{experiment.value.code || '@Messages("experiments.noCode")'}}</h1>
	</div>
	</div>
</div>
<div class="row">
<div class="col-md-12 col-lg-12">
<div ng-class="message.clazz" ng-show="message.text !== undefined">
	<strong>{{message.text}}</strong><button class="btn btn-link" ng-click="message.showDetails=!message.showDetails" ng-show="message.isDetails">@(Messages("experiments.msg.details"))</button>
	<div ng-show="message.showDetails">
	    <ul>
    		<li ng-repeat="(key1, value1) in message.details">{{key1}}
    		<ul>
    			<li ng-repeat="(key2, value2) in value1"> {{value2}} </li>
    		</ul>
    		</li>
    	</ul>	
	</div>
</div>
</div>
</div>

<div class="row">
		<div class="col-md-12 col-lg-12">	
		<div class="row">
			<div class="col-md-5 col-lg-5">
			  <div class="panel panel-default">
			  <div class="panel-heading">
			  	<div class="btn-group pull-right" ng-switch on="experiment.experimentInformation.enabled">
						<button class="btn btn-default btn-xs" ng-click="experiment.experimentInformation.toggleEdit()" ng-switch-when="false" data-toggle="tooltip" title="@Messages("experiments.edit")"><i class="fa fa-edit"></i></button>
						<button class="btn btn-default btn-xs" ng-click="experiment.experimentInformation.toggleEdit()" ng-switch-when="true" data-toggle="tooltip" title="@Messages("experiments.unedit")"><i class="fa fa-undo"></i></button>	
				  </div>
				  <h2 class="panel-title">Exp&eacute;rience</h2>			  	
			  </div>
			  <div class="panel-body">
			    <form class="form-horizontal">
					@columnLabelValue(Messages("experiments.type")){
						<p class="form-control-static">{{experiment.value.typeCode}}</p>
					}			    
					@columnLabelValue(Messages("experiments.protocol")){
						<select class="form-control"
								ng-model="experiment.value.protocolCode"
								ng-readonly="!experiment.experimentInformation.enabled"
								ng-options="protocol.code as protocol.name for protocol in lists.get('protocols')"
								ng-disabled="!experiment.experimentInformation.enabled">
									<option value="">@Messages("experiments.select.protocols")</option>
							</select>
					}	
			   	 	@columnLabelValue(Messages("experiments.state")){
			   	 		<p class="form-control-static">{{experiment.value.state.code | codes:'state'}}</p>
					}
			    	@columnLabelValue(Messages("experiments.resolution")){
							<div class="form-control"  bt-select ng-model="experiment.value.state.resolutionCodes" multiple="true" placeholder="@Messages("experiments.select.resolutions")" 
									bt-options="resolution.code as resolution.name for resolution in lists.get('resolutions')" 
									ng-disabled="!experiment.experimentInformation.enabled"
									ng-readonly="!experiment.experimentInformation.enabled" auto-select>
							</div>	
					}	
					
						
					<!--  -->
					<div class="form-group" ng-repeat="expp in experiment.experimentProperties.inputs" ng-if="getLevel(expp.levels,'Experiment')">									
						<label  class="col-md-6 col-lg-6 control-label">{{expp.name}}</label>
						<div class="col-md-6 col-lg-6" ng-switch on="expp.choiceInList">
							<input class="form-control" type="text" ng-switch-when="false" class="input-small"
								ng-readonly="!experiment.experimentProperties.enabled"
								ng-model="experiment.value.experimentProperties[expp.code].value" />
								
							<select class="form-control"  ng-readonly="!experiment.experimentInformation.enabled" ng-disabled="!experiment.experimentInformation.enabled" ng-model="experiment.value.experimentProperties[expp.code].value" ng-switch-when="true" >
								<option ng-repeat="opt in expp.possibleValues" value="{{opt.value}}">{{opt.value}}</option>
							   </select>
						</div>
						
					</div>							
					<!--  -->													
			    </form>
			  </div>
			</div>
		
			</div>
			<div class="col-md-5 col-lg-5">
				<div class="panel panel-default">
			  	<div class="panel-heading">
			  	<div class="btn-group pull-right" ng-switch on="experiment.instrumentInformation.enabled">
						<button class="btn btn-default btn-xs" ng-click="experiment.instrumentInformation.toggleEdit();experiment.instrumentProperties.toggleEdit()" ng-switch-when="false" data-toggle="tooltip" title="@Messages("experiments.edit")"><i class="fa fa-edit"></i></button>
						<button class="btn btn-default btn-xs" ng-click="experiment.instrumentInformation.toggleEdit();experiment.instrumentProperties.toggleEdit()" ng-switch-when="true" data-toggle="tooltip" title="@Messages("experiments.unedit")"><i class="fa fa-undo"></i></button>	
				  </div>
				  <h2 class="panel-title">Instrument</h2>			  	
			  </div>
			  <div class="panel-body">
			    <form class="form-horizontal">
			    
			    @columnLabelValue(Messages("experiments.intrumentUsedType")){
						<select class="form-control"
					ng-change="getInstruments()"
					ng-model="experiment.value.instrument.typeCode"
					auto-select
					ng-readonly="!experiment.instrumentInformation.enabled"
					ng-options="instrumentUsedType.code as instrumentUsedType.name for instrumentUsedType in lists.get('instrumentUsedTypes')"
					ng-disabled="!experiment.instrumentInformation.enabled">
						<option value="">@Messages("experiments.select.intrumentUsedType")</option>
					</select>
				}
			     
			     @columnLabelValue(Messages("experiments.intrument")){
			     	<select class="form-control"
											ng-model="experiment.value.instrument.code"
											ng-readonly="!experiment.instrumentInformation.enabled"
											ng-options="instrumentInformation.code as instrumentInformation.name for instrumentInformation in lists.get('instruments')"
											ng-disabled="!experiment.instrumentInformation.enabled"
											ng-hide="!experiment.value.instrument.typeCode"
											ng-change="getInputTemplate()"
											>
												<option value="">@Messages("experiments.select.instrument")</option>
											</select>
			     }
			    
			   <div class="form-group" ng-repeat="instp in experiment.instrumentProperties.inputs"  ng-if="getLevel(instp.levels,'Instrument')">
								
						<label  class="col-md-6 col-lg-6 control-label">{{instp.name}}</label>
						<div class="col-md-6 col-lg-6" ng-switch on="instp.choiceInList">
							<input class="form-control" type="text" ng-switch-when="false" class="input-small"
								ng-readonly="!experiment.instrumentInformation.enabled"
								ng-model="experiment.value.instrumentProperties[instp.code].value" />
							
							<select class="form-control" ng-options="opt.value as opt.value for opt in instp.possibleValues"  
								ng-readonly="!experiment.instrumentInformation.enabled" ng-disabled="!experiment.instrumentInformation.enabled" 
								ng-model="experiment.value.instrumentProperties[instp.code].value" ng-switch-when="true" 
								select-auto="instp.possibleValues">
						    <option value="">SÃ©lect. {{instp.name}}</option>
						    </select>
						</div>
				</div>	
				
				<div class="form-group" ng-hide="!experiment.value.instrument.typeCode || experiment.outputVoid">
					<label class="col-md-6 col-lg-6 control-label">@Messages("experiments.intrumentCategory")</label>
					<div class="col-md-6 col-lg-6">
									<select  class="form-control"
									auto-select
									ng-model="experiment.value.instrument.outContainerSupportCategoryCode"
									ng-readonly="!experiment.instrumentInformation.enabled"
									ng-change="getTemplate()"
									ng-options="instrumentCategory.code as instrumentCategory.name for instrumentCategory in lists.get('containerSupportCategories')"
									ng-disabled="!experiment.instrumentInformation.enabled"
									ng-hide="!experiment.value.instrument.typeCode || experiment.outputVoid">
										<option value="">@Messages("experiments.select.outContainerSupportCategoryCode")</option>
									</select>
					</div>
				</div>																										    
			    </form>
			    </div>
			    </div>
		
			</div>
			<div class="col-md-2 col-lg-2">
				<div class="panel panel-default">
				  <div class="panel-heading">			  
				  <h2 class="panel-title">Info</h2>			  	
				  </div>
				  <div class="panel-body">
				  
				    <form class="form-horizontal">
				    @columnLabelValue(Messages("experiments.creationDate")){
						<p class="form-control-static">{{experiment.value.traceInformation.creationDate | date:'yyyy-MM-dd HH:mm:ss'}}</p>
					}
				    @columnLabelValue(Messages("experiments.createUser")){
						<p class="form-control-static">{{experiment.value.traceInformation.createUser}}</p>
					}
				   	@columnLabelValue(Messages("experiments.modifyDate")){
						<p class="form-control-static">{{experiment.value.traceInformation.modifyDate | date:'yyyy-MM-dd HH:mm:ss'}}</p>
					}	
				    @columnLabelValue(Messages("experiments.modifyBy")){
						<p class="form-control-static">{{experiment.value.traceInformation.modifyUser}}</p>
					}
				   			    								
					</form>
				  </div>
				</div>
			</div>
			
		</div>	
			  
			
		
		
		</div>
</div>
<div ng-include="experiment.inputTemplate">

</div>
<div ng-include="getOutputTemplate().url">

</div>
<div class="row">
<div class="col-md-12 col-lg-12">
<div class="panel panel-default">
  <!-- Default panel contents -->
  <div class="panel-heading">@Messages("experiment.comments")</div>
  <div class="panel-body">
   <ul class="list-group">
   <li class="list-group-item" ng-repeat="com in experiment.value.comments">{{com.comment}}</li>   
  </ul>
  </div>
</div>
</div>
</div>	

			
		