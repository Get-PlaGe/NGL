@(currentUser:java.lang.String)

@import views.html.helper._

<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title">@Messages("experiment.addComment")</h4>
      </div>
      <div class="modal-body">
      	<form>
        	<label>@Messages("experiment.leaveComment")</label>
			<textarea  class="form-control" ng-model="experiment.comment.comment" ></textarea>
		
		</form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-default" data-dismiss="modal" aria-hidden="true">@Messages("experiment.cancelComment")</button>
		<button data-dismiss="modal" class="btn btn-primary" ng-if="experiment.comment.code == undefined"  ng-click="experiment.comments.save();">@Messages("experiment.sendComment")</button>
      	<button data-dismiss="modal" class="btn btn-primary" ng-if="experiment.comment.code != undefined" ng-click="experiment.comments.update(experiment.comment);">@Messages("experiment.comment.update")</button>
      
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<!-- ----------------------------------------------------------------------------- -->
<!-- Modal to display image in full size -->
	<div id="modalImage" class="modal fade"  tabindex="-1" role="dialog"
		aria-labelledby="modalImageLabel" aria-hidden="true" style="left:{{modalLeft}}px; top:{{modalTop}}px;position:fixed;width:100%">
		
    		<div class="modal-content" style="width:{{modalWidth}}px; border:0px">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					<h3 class="modal-title">{{modalTitle}}</h3>	
				</div>
				<div class="modal-body" style="padding:0px">
					<img src="data:image/png;base64,{{modalImage}}" style="width:{{modalWidth}}px; height:{{modalHeight}}px;" />
				</div>
				<div class="modal-footer">
				</div>
			</div>
		
	</div>
<!-- -------------------------------------------------------------------------------- -->
<!-- Modal to display choise when user click finish -->
	<div id="modalResolutionProcess" class="modal fade"  tabindex="-1" role="dialog"
		aria-labelledby="modalResolutionProcessLabel" aria-hidden="true">
		<div class="modal-dialog">
    		<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					 <h4 class="modal-title">@Messages("experiment.finishExperiment")</h4>
					<h3 class="modal-title">{{modalTitle}}</h3>	
				</div>
				<div class="modal-body" style="padding:0px">
					
				</div>
				<div class="modal-footer">
					<button class="btn btn-default" data-dismiss="modal" ng-click="getRefresh()" aria-hidden="true">@Messages("experiment.continueProcess")</button>
					<button data-dismiss="modal" class="btn btn-primary" ng-click="experiment.retry=true;saveAllAndChangeState()">@Messages("experiment.retryExperiment")</button>
					<button data-dismiss="modal" class="btn btn-primary" ng-click="experiment.stopProcess=true;saveAllAndChangeState()">@Messages("experiment.stopProcess")</button>   				
      
				</div>
			</div>
		</div>
	</div>
<!-- -------------------------------------------------------------------------------- -->


<div class="row">
<div class="col-md-10 col-lg-10 " style="position:fixed;background-color:white;z-index:100;top: 30px;">
	<div class="page-header">
	<div class="btn-toolbar" style="float:right;width:600px">
			<button class="btn btn-default" ng-if="doneAndRecorded==false" ng-click="edit()" ng-show="editMode==false" data-toggle="tooltip" title="@Messages("experiments.edit")"><i class="fa fa-edit"></i></button>
			<button class="btn btn-default" ng-if="doneAndRecorded==false" ng-click="unedit()" ng-show="editMode==true" data-toggle="tooltip" title="@Messages("experiments.unedit")"><i class="fa fa-undo"></i></button>	
				  			
			<button class="btn btn-default" ng-show="experiment.value.state.code == 'N'" ng-disabled="experiment.value._id == null" ng-click="saveAllAndChangeState()" >@Messages("experiments.begin_progress")</button>
			<button  class="btn btn-default"  ng-show="experiment.value.state.code == 'IP'" ng-disabled="experiment.value._id == null" ng-click="saveAllAndChangeState();experiment.retry=false;experiment.stopProcess=false" >@Messages("experiments.finish")</button>
		<div class="btn-group " id="experiment_action">
			<a class="btn btn-default dropdown-toggle" data-toggle="dropdown"> Actions <span
				class="caret"></span>
			</a>
			<ul class="dropdown-menu dropdown-menu-right">
				<li><a href="#" ng-disabled="experiment.value.stateCode != 'IP'"  ng-click="generateSampleSheet()" >@Messages("experiments.sampleSheet")</a></li>
			</ul>
		</div>
		<button class="btn btn-primary" ng-disabled="saveInProgress == true" ng-click="saveAllPromise();" data-toggle="tooltip"  title="@Messages("experiments.save_all")">
			<i class="fa fa-save"></i>
		</button>
		<button class="btn btn-default"  ng-disabled="experiment.value._id == null"  ng-click="experiment.comment = {}" data-toggle="modal" data-target="#myModal">@Messages("experiment.addComment")</button>
		
										
	</div>
	<h1>{{experiment.value.code || '@Messages("experiments.noCode")'}}</h1>
	</div>
	</div>
</div>
<div class="row">
<div class="col-md-12 col-lg-12" style="margin-top: 100px;">
<div ng-class="message.clazz" ng-show="message.text !== undefined">
	<strong>{{message.text}}</strong><button class="btn btn-link" ng-click="message.showDetails=!message.showDetails" ng-show="message.isDetails">@(Messages("experiments.msg.details"))</button>
	<div ng-show="message.showDetails">
	    <ul>
    		<li ng-repeat="(key1, value1) in message.details">{{key1}}
    		<ul>
    			<li ng-repeat="(key2, value2) in value1"> {{value2}} </li>
    		</ul>
    		</li>
    	</ul>	
	</div>
</div>
</div>
</div>

<div class="row">
		<div class="col-md-12 col-lg-12">	
		<div class="row">
			<div class="col-md-5 col-lg-5">
			  <div class="panel panel-default">
			  <div class="panel-heading">
			  	<div class="btn-group pull-right" ng-switch on="experiment.experimentInformation.enabled" ng-if="doneAndRecorded==false">
						<button class="btn btn-default btn-xs" ng-click="experiment.experimentInformation.toggleEdit()" ng-switch-when="false" data-toggle="tooltip" title="@Messages("experiments.edit")"><i class="fa fa-edit"></i></button>
						<button class="btn btn-default btn-xs" ng-click="experiment.experimentInformation.toggleEdit()" ng-switch-when="true" data-toggle="tooltip" title="@Messages("experiments.unedit")"><i class="fa fa-undo"></i></button>	
				  </div>
				  <h2 class="panel-title">Exp&eacute;rience</h2>			  	
			  </div>
			  <div class="panel-body">
			    <form class="form-horizontal">
					@columnLabelValue(Messages("experiments.type")){
						<p class="form-control-static">{{experiment.value.typeCode}}</p>
					}			    
					@columnLabelValue(Messages("experiments.protocol")){
					<div ng-switch on="doneAndRecorded">						
						<p ng-switch-when="true" class="form-control-static" ng-model='experiment.value.protocolCode'>
						 {{experiment.value.protocolCode}} </p>
						<div ng-switch-when="false">
							<div bt-select class="form-control"
								ng-model="experiment.value.protocolCode"
								ng-readonly="!experiment.experimentInformation.enabled"
								bt-options="protocol.code as protocol.name for protocol in lists.get('protocols')"
								ng-disabled="!experiment.experimentInformation.enabled"
								auto-select>
							</div>
						</div>
					</div>
					}	
			   	 	@columnLabelValue(Messages("experiments.state")){
			   	 		<p class="form-control-static">{{experiment.value.state.code | codes:'state'}}</p>
					}
					
					
			    	@columnLabelValue(Messages("experiments.resolution")){
							<div bt-select class="form-control" ng-model="experiment.value.state.resolutionCodes" multiple="true"
							ng-readonly="!experiment.experimentInformation.enabled"  ng-disabled="!experiment.experimentInformation.enabled"
							placeholder="@Messages("experiments.select.resolutions")" bt-options="valid.code as valid.name for valid in lists.getResolutions()" ng-edit="!doneAndRecorded"></div>							
						
					}	
					
						
					<!--  -->
					<div class="form-group" ng-repeat="expp in experiment.experimentProperties.inputs" ng-if="getLevel(expp.levels,'Experiment')">									
						<label  class="col-md-6 col-lg-6 control-label">{{expp.name}}</label>
						<div class="col-md-6 col-lg-6" ng-switch on="expp.choiceInList">
							<input ng-if="expp.valueType != 'java.util.Date'" class="form-control" type="text" ng-switch-when="false" class="input-small"
								ng-readonly="!experiment.experimentInformation.enabled" ng-disabled="!experiment.experimentInformation.enabled"
								ng-model="experiment.value.experimentProperties[expp.code].value"/>
								
							<input ng-if="expp.valueType == 'java.util.Date'" class="form-control" type="text" ng-switch-when="false" class="input-small"
								ng-readonly="!experiment.experimentInformation.enabled" ng-disabled="!experiment.experimentInformation.enabled"
								placeholder="@Messages("date.format.french")" 
								ng-model="experiment.value.experimentProperties[expp.code].value" date-timestamp/>
								
							<div bt-select class="form-control"  
									ng-readonly="!experiment.experimentInformation.enabled"
									ng-disabled="!experiment.experimentInformation.enabled" 
									ng-model="experiment.value.experimentProperties[expp.code].value" 
									ng-switch-when="true" 
									auto-select
									bt-options="possibleValues.code as possibleValues.name for possibleValues in expp.possibleValues">
							   </div>
						</div>
						
					</div>							
					<!--  -->													
			    </form>
			  </div>
			</div>
		
			</div>
			<div class="col-md-5 col-lg-5">
				<div class="panel panel-default">
			  	<div class="panel-heading">
			  	<div class="btn-group pull-right" ng-switch on="experiment.instrumentInformation.enabled" ng-if="doneAndRecorded==false">
						<button class="btn btn-default btn-xs" ng-click="experiment.instrumentInformation.toggleEdit();experiment.instrumentProperties.toggleEdit()" ng-switch-when="false" data-toggle="tooltip" title="@Messages("experiments.edit")"><i class="fa fa-edit"></i></button>
						<button class="btn btn-default btn-xs" ng-click="experiment.instrumentInformation.toggleEdit();experiment.instrumentProperties.toggleEdit()" ng-switch-when="true" data-toggle="tooltip" title="@Messages("experiments.unedit")"><i class="fa fa-undo"></i></button>	
				  </div>
				  <h2 class="panel-title">Instrument</h2>			  	
			  </div>
			  <div class="panel-body">
			    <form class="form-horizontal">
			    
			    @columnLabelValue(Messages("experiments.intrumentUsedType")){
					<div ng-switch on="doneAndRecorded">						
						<p ng-switch-when="true" class="form-control-static" ng-model='experiment.value.instrument.typeCode'>
						 {{experiment.value.instrument.typeCode}} </p>
						<div ng-switch-when="false">					
					<div  bt-select  class="form-control"
					ng-change="getInstrumentsTrigger()"
					ng-model="experiment.value.instrument.typeCode"
					auto-select
					ng-readonly="!experiment.instrumentInformation.enabled"
					bt-options="instrumentUsedType.code as instrumentUsedType.name for instrumentUsedType in lists.get('instrumentUsedTypes')"
					ng-disabled="!experiment.instrumentInformation.enabled">
						<option value="">@Messages("experiments.select.intrumentUsedType")</option>
					</div>
					</div>
					</div>
					
				}
			     
			     @columnLabelValue(Messages("experiments.intrument")){
			     	<div ng-switch on="doneAndRecorded">						
						<p ng-switch-when="true" class="form-control-static" ng-model='experiment.value.instrument.code'>
						 {{experiment.value.instrument.code}} </p>
						<div ng-switch-when="false">
			     	
			     	<div  bt-select class="form-control"
											ng-model="experiment.value.instrument.code"
											ng-readonly="!experiment.instrumentInformation.enabled"
											bt-options="instrumentInformation.code as instrumentInformation.name for instrumentInformation in lists.get('instruments')"
											ng-disabled="!experiment.instrumentInformation.enabled"
											ng-hide="!experiment.value.instrument.typeCode"
											ng-change="getInputTemplate()"
											auto-select
											placeholder='@Messages("experiments.select.instrument")'
											>
					</div>
					</div>
					</div>
			     }			     

				<div class="form-group" ng-hide="!experiment.value.instrument.typeCode || experiment.outputVoid">
					<label class="col-md-6 col-lg-6 control-label">@Messages("experiments.intrumentCategory")</label>
					<div class="col-md-6 col-lg-6">
					<div ng-switch on="doneAndRecorded">						
						<p ng-switch-when="true" class="form-control-static" ng-model='experiment.value.instrument.outContainerSupportCategoryCode'>
						 {{experiment.value.instrument.outContainerSupportCategoryCode}} </p>
						<div ng-switch-when="false">					
									<div bt-select  class="form-control"
									auto-select
									ng-model="experiment.value.instrument.outContainerSupportCategoryCode"
									ng-readonly="!experiment.instrumentInformation.enabled"
									ng-change="getTemplate()"
									bt-options="instrumentCategory.code as instrumentCategory.name for instrumentCategory in lists.get('containerSupportCategories')"
									ng-disabled="!experiment.instrumentInformation.enabled"
									ng-hide="!experiment.value.instrument.typeCode || experiment.outputVoid"
									placeholder='@Messages("experiments.select.outContainerSupportCategoryCode")'>
									</div>
									</div>
									</div>
					</div>
				</div>	 	
			    
			   <div class="form-group" ng-repeat="instp in experiment.instrumentProperties.inputs"  ng-if="getLevel(instp.levels,'Instrument')">
								
						<label  class="col-md-6 col-lg-6 control-label">{{instp.name}}</label>
					
						<div class="col-md-6 col-lg-6" ng-if="instp.valueType == 'java.awt.Image'">
							<input type="file" ng-disabled="!experiment.instrumentInformation.enabled" base64-img="experiment.value.instrumentProperties[instp.code]" />
							<div ng-click="setImage(experiment.value.instrumentProperties[instp.code].value,experiment.value.instrumentProperties[instp.code].fullname,experiment.value.instrumentProperties[instp.code].width,
							    experiment.value.instrumentProperties[instp.code].height)" class="thumbnail col-md-6 col-lg-6"  ng-show="experiment.value.instrumentProperties[instp.code] != undefined && experiment.value.instrumentProperties[instp.code].value != ''" >
								
								 <div data-target="#modalImage" role="button" data-toggle="modal" >
							     <a href="#">
								<img  src="data:image/{{experiment.value.instrumentProperties[instp.code].extension}};base64,{{experiment.value.instrumentProperties[instp.code].value}}">
								</a>
									
								</div>
							</div>
							<button class="btn pull-left"  ng-show="experiment.value.instrumentProperties[instp.code] != undefined && experiment.value.instrumentProperties[instp.code].value != ''" ng-click="experiment.value.instrumentProperties[instp.code] = undefined" ng-show="experiment.value.instrumentProperties[instp.code].value != ''"><i class="fa fa-trash-o"></i></button>	
						</div>
						<div ng-if="instp.valueType != 'java.awt.Image'">
						<div ng-switch on="doneAndRecorded">						
						<p ng-switch-when="true" class="form-control-static col-md-6 col-lg-6" ng-model='experiment.value.instrumentProperties[instp.code].value'>
						 {{experiment.value.instrumentProperties[instp.code].value}} </p>
						 
						<div ng-switch-when="false">	
						
							<div class="col-md-6 col-lg-6" ng-switch on="instp.choiceInList">
								<input class="form-control" type="text" title='{{instp.name}}' ng-switch-when="false" class="input-small"
									ng-readonly="!experiment.instrumentInformation.enabled"
									ng-model="experiment.value.instrumentProperties[instp.code].value"
									ng-disabled="!experiment.instrumentInformation.enabled"/>
								
								<div bt-select class="form-control" bt-options="opt.value as opt.value for opt in instp.possibleValues" dt-default-value="instp.defaultValue"
									ng-readonly="!experiment.instrumentInformation.enabled" ng-disabled="!experiment.instrumentInformation.enabled" 
									ng-model="experiment.value.instrumentProperties[instp.code].value" ng-switch-when="true" 
									auto-select>
							    </div>
							</div>
							</div>
							</div>
							
						</div>
				</div>	
																												    
			    </form>
			    </div>
			    </div>
		
			</div>
			<div class="col-md-2 col-lg-2">
				<div class="panel panel-default">
				  <div class="panel-heading">			  
				  <h2 class="panel-title">Info</h2>			  	
				  </div>
				  <div class="panel-body">
				  
				    <form class="form-horizontal">
				    @columnLabelValue(Messages("experiments.creationDate")){
						<p class="form-control-static">{{experiment.value.traceInformation.creationDate | date:'yyyy-MM-dd HH:mm:ss'}}</p>
					}
				    @columnLabelValue(Messages("experiments.createUser")){
						<p class="form-control-static">{{experiment.value.traceInformation.createUser}}</p>
					}
				   	@columnLabelValue(Messages("experiments.modifyDate")){
						<p class="form-control-static">{{experiment.value.traceInformation.modifyDate | date:'yyyy-MM-dd HH:mm:ss'}}</p>
					}	
				    @columnLabelValue(Messages("experiments.modifyBy")){
						<p class="form-control-static">{{experiment.value.traceInformation.modifyUser}}</p>
					}
				   			    								
					</form>
				  </div>
				</div>
			</div>
			
		</div>	
			  
			
		
		
		</div>
</div>
<div ng-include="experiment.inputTemplate">

</div>
<div ng-include="getOutputTemplate().url">

</div>
<div class="row">
<div class="col-md-12 col-lg-12">
<div class="panel panel-default">
  <!-- Default panel contents -->
  <div class="panel-heading">@Messages("experiment.reagents")</div>
  <div class="panel-body">
 	<div class="col-md-12 col-lg-12" datatable="datatableReagent"></div>
  </div>
</div>
</div>
</div>
<div class="row">
<div class="col-md-12 col-lg-12">
<div class="panel panel-default">
  <!-- Default panel contents -->
  <div class="panel-heading">@Messages("experiment.comments")</div>
  <div class="panel-body">
   <ul class="list-group">
   <li class="list-group-item" ng-repeat="com in experiment.value.comments">
   <div class="row">
   <div class="col-lg-1" style="text-align:center">
  		<img src="http://www.naijaticketshop.com/images/default_profile.jpg" width=32 height=32 alt="{{com.createUser}}" style="margin-left:auto;margin-right:auto"/><br>
   		<b>{{com.createUser}}</b><br>
    	{{com.creationDate | date:'yyyy-MM-dd HH:mm:ss'}}
   	</div>
    <div class="col-lg-8"  ng-bind-html="convertToBr(com.comment)">
     	
    </div>
    <button class="btn commentsButtons pull-right" ng-show="com.createUser == '@currentUser'" ng-click="experiment.comments.delete(com)"><i class="fa fa-trash-o"></i></button>
    <button class="btn commentsButtons pull-right" ng-show="com.createUser == '@currentUser'" data-toggle="modal" data-target="#myModal" ng-click="experiment.comment = com"><i class="fa fa-edit"></i></button>
    </div>
   </li>   
  </ul>
  </div>
</div>
</div>
</div>	

			
		