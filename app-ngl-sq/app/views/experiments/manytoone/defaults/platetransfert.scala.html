@()

<div class="col-md-12 col-lg-12" ng-controller="PlateTransfertCtrl" ng-switch="atmService.inputContainerSupportCategoryCode">
<div ng-switch-when="tube">
<ul class="nav nav-tabs margin-bottom-5" role="tablist">
  <li class="active"><a href="" role="tab" data-target="#tube" data-toggle="tab">@Messages("experiments.tube.design")</a></li>
  <li><a href="" role="tab"  data-target="#roadmap" data-toggle="tab" ng-click="atmService.data.updateDatatable()">@Messages("experiments.calculation.sheet")</a></li>
</ul>

<div class="tab-content"  >
	<div class="tab-pane active" id="tube">
		<div class="row">
		<div class="col-md-12 col-lg-12">
		<div class="row">
		
		<!-- InputContainers table -->
		<div ng-model="atmService.data.inputContainers"  class="col-md-5 col-lg-5" droppable ng-if="mainService.isEditMode()">
			<div class="panel panel-primary"  style="border-style:dashed">				
			<div class="panel-body" ng-if="atmService.data.inputContainers.length==0">		
				<p><i class="fa fa-download"></i> @Messages("experiments.inputs")</p>
			</div>
			
			<table class="table" ng-if="atmService.data.inputContainers.length > 0">
			<thead>
				<tr>
					<th>
					</th>
					<th>
						@Messages("containers.table.code")
					</th>
					<th>
						@Messages("containers.table.fromTransformationTypeCodes")
					</th>
					<th>
						@Messages("containers.table.tags")
					</th>
					<th>
						@Messages("containers.table.state.code")
					</th>
					<th>
						@Messages("containers.table.volume") (µL)
					</th>
					<th>
						@Messages("containers.table.concentration") 
					</th>									
				</tr>
				</thead>				
				<tr ng-model="container" ng-repeat="container in atmService.data.inputContainers | orderBy:'code' track by $index" >
					<td>
						<button class="btn btn-default btn-xs"  ng-click="atmService.data.deleteInputContainer(container)" ng-disabled="!mainService.isEditModeAvailable() && !isNewState()"><i class="fa fa-trash-o"></i></button>
					</td>
					<td>
						{{container.code}}
					</td>
					<td>
						<div list-resize='container.fromTransformationTypeCodes | unique | codes:"type"' list-resize-min-size='3'>
						
					</td>					
					<td>
						<div list-resize='container.contents | getArray:"properties.tag.value"| unique' list-resize-min-size='5' below vertical>																
					</td>
					<td>
						{{container.state.code | codes:'state'}}
					</td>
					<td>
						{{container.volume.value}}
					</td>
					<td>
						{{container.concentration.value | number}} {{container.concentration.unit}}
					</td>						
				</tr>				
			</table>
			</div>	
		</div>
		<div class="col-md-1 col-lg-1" ng-if="mainService.isEditMode()">
		<!-- Drop buttons -->
		
		<div ng-if="(atmService.data.atm[0].inputContainerUseds.length==0 || atmService.data.inputContainers.length>0 )">
		<button class="btn btn-default btn-lg center-block" ng-click="atmService.data.dropInAllInputContainer(0)" >
		<i class="fa fa-sign-in fa-2x"></i>
		</button>
		</div>
		<div ng-if="atmService.data.inputContainers.length==0">
		<button class="btn btn-default btn-lg center-block" ng-click="atmService.data.dropOutAllInputContainer(0)" >
		<i class="fa fa-sign-in fa-2x fa-rotate-180"></i>
		</button>
		</div>

		</div>
		<!-- OutputContainers table -->
		<div class="col-md-6 col-lg-6 flowcellTable">		
			<table class="table" >
				<thead>
					<tr>
						<th colspan="7">
							@Messages("experiments.inputs")
						</th>
						<th colspan="2">
							@Messages("experiments.outputs")
						</th>												
					</tr>
					<tr>
						<th>
							@Messages("containers.table.code")
						</th>
						<th>
							@Messages("containers.table.fromTransformationTypeCodes")
						</th>						
						<th>
							@Messages("containers.table.project_sample")
						</th>						
						<th>
							@Messages("containers.table.tags")
						</th>
						<th>
							@Messages("containers.table.state.code")
						</th>
						<th>
							@Messages("containers.table.volume") (µL)
						</th>
						<th>
							@Messages("containers.table.concentration")
						</th>									
						<th>
							@Messages("containers.table.percentageInsidePool")
						</th>
						<th>
							@Messages("containers.table.code")
						</th>
						<th>
							@Messages("containers.table.volume") (µL)
						</th>		
					</tr>
				<thead>
				<tbody>
						<tr ng-model="inputContainerUsed" ng-repeat="inputContainerUsed in atmService.data.atm[0].inputContainerUseds | orderBy:'code' track by $index" draggable >									
							<td>
								{{inputContainerUsed.code}}
							</td>
							<td>
								<div list-resize='inputContainerUsed.fromTransformationTypeCodes | unique | codes:"type"' list-resize-min-size='5' below vertical>
							</td>
							<td>
								<div list-resize="inputContainerUsed.contents | collect:'projectCode+&quot; / &quot;+sampleCode' | unique" list-resize-min-size="5" vertical="true">																					
							</td>						
							<td>
								<div list-resize='inputContainerUsed.contents | getArray:"properties.tag.value"| unique' list-resize-min-size='5' below vertical>															
							</td>
							<td>
								{{inputContainerUsed.state.code | codes:'state'}}
							</td>
							<td>
								{{inputContainerUsed.volume.value}}
							</td>
							<td>
								{{inputContainerUsed.concentration.value | number}} {{inputContainerUsed.concentration.unit}}
							</td> 														
							<td>
								<div ng-switch on="mainService.isEditMode()">						
									<p class="form-control-static" ng-switch-when="false" ng-bind="inputContainerUsed.percentage" />						 
									<div ng-switch-when="true">
										<input class="form-control input-sm" 
											type="text"
											ng-model="inputContainerUsed.percentage" 
											title='@Messages("containers.table.percentage")' 
											ng-change="atmService.data.updateDatatable()"/>									
									</div>
								</div>
							</td>
						
							<td rowspan="{{atmService.data.atm[0].inputContainerUseds.length}}"
								ng-if="$index === 0">
								{{atmService.data.atm[0].outputContainerUseds[0].code}}
							</td>
							<td rowspan="{{atmService.data.atm[0].inputContainerUseds.length}}"	ng-if="$index === 0">
								<div ng-switch on="mainService.isEditMode()">						
									<p class="form-control-static" ng-switch-when="false" ng-bind="atmService.data.atm[0].outputContainerUseds[0].volume.value" />						 
									<div ng-switch-when="true">
										<input class="form-control input-sm" type="text" title="Messages("containers.table.volume")"									
										ng-model="atmService.data.atm[0].outputContainerUseds[0].volume.value"
							   			ng-change="atmService.data.updateDatatable()"								   			
						   				/>										
									</div>
								</div>						
							</td>							
						</tr>						
				</tbody>
				
			</table>
		</div>
		</div>
	
		
	</div>
	</div>
	</div>		
		
	<div class="tab-pane" id="roadmap">
	<div class="row roadmap">
		<div class="col-md-12 col-lg-12" ultimate-datatable="atmService.data.datatable"></div>
	</div>
	</div>
</div>		
</div>


<div ng-switch-when="96-well-plate">
<ul class="nav nav-tabs margin-bottom-5" role="tablist">
  <li class="active"><a href="" role="tab" data-target="#plate" data-toggle="tab">@Messages("experiments.tube.design")</a></li>
  <li><a href="" role="tab"  data-target="#roadmap" data-toggle="tab" ng-click="atmService.data.updateDatatable()">@Messages("experiments.calculation.sheet")</a></li>
</ul>

<div class="tab-content"  >
	<div class="tab-pane active" id="plate">
		<div class="row">
		<div class="col-md-7 col-lg-7">
			<table class="table table-bordered table-condensed">
				<thead>
				     <tr>
				         <th ng-click="atmService.data.selectInputContainers(atmService.data.inputContainerSupports[0])"></th>
				         <th ng-repeat="i in [1,2,3,4,5,6,7,8,9,10,11,12]" ng-click="atmService.data.selectInputContainers(atmService.data.inputContainerSupports[0],undefined,i)">{{i}}</th>
				     </tr>
				</thead>
				<tbody>
				    <tr ng-repeat="line in ['A','B','C','D','E','F','G','H']">
				        <td ng-click="atmService.data.selectInputContainers(atmService.data.inputContainerSupports[0],line)"><strong>{{line}}</strong></td>
				        <td ng-repeat="container in atmService.data.getInputContainers(atmService.data.inputContainerSupports[0], line ,[1,2,3,4,5,6,7,8,9,10,11,12]) track by $index" 
				        	ng-click="atmService.data.selectInputContainer(container, $event)"
				        	ng-class="atmService.data.getInputContainerCellClass(container)">
				        		<div list-resize="container.contents | collect:'projectCode+&quot; / &quot;+sampleCode+&quot; / &quot;+properties.tag.value'"></div>				        		        	    						    					
				         </td>          
				    </tr>
				  
				<tbody>				 
			</table>	
		</div>
		<div class="col-md-1 col-lg-1" ng-if="mainService.isEditMode()">
		<!-- Drop buttons -->
		
		<div>
		<button class="btn btn-default btn-lg center-block" ng-click="atmService.data.dropInSelectInputContainer()" ng-disabled="!atmService.data.isSelectInputContainers()">
		<i class="fa fa-sign-in fa-2x"></i>
		</button>
		</div>
		
		</div>
		
		
		<div class="col-md-12 col-lg-4 flowcellTable table-responsive">
			<table class="table" >
			<thead>
			<tr>
			<th>
			</th>
			<th>
				<button ng-click="atmService.data.hideAllATM()"  ng-if="atmService.data.isAllATMViewOpen" class="btn btn-default btn-xs"><i class="fa fa-eye-slash"></i></button>
				<button ng-click="atmService.data.showAllATM()"  ng-if="!atmService.data.isAllATMViewOpen" class="btn btn-default btn-xs"><i class="fa fa-eye"></i></button>							
			</th>
			
			<th ng-if="atmService.data.isAllATMViewOpen">
				@Messages("containers.table.code")
			</th>
			<th ng-if="atmService.data.isAllATMViewOpen">
				@Messages("containers.table.percentage")
			</th>
			<th ng-if="atmService.data.isAllATMViewOpen" class="sampleCodeAndTags">
				@Messages("containers.table.sampleCodeAndTags")
			</th>			
			<th ng-if="atmService.data.isAllATMViewOpen">
				@Messages("containers.table.sampleTypes")
			</th>
			<th ng-if="atmService.data.isAllATMViewOpen">
				@Messages("containers.table.libProcessTypeCodes")
			</th>
			<th  ng-if="atmService.data.isAllATMViewOpen"
				ng-repeat="property in outputContainerProperties track by $index">
				{{property.name}}<span ng-if="property.displayMeasureValue"> ({{property.displayMeasureValue.value}})</span>
			</th>
			<th ng-if="!atmService.data.isAllATMViewOpen" colspan="{{5 + outputContainerProperties.length}}"></th>
			</tr>
			
			</thead>
			<tbody ng-if="atmService.data.isAllATMViewOpen && mainService.isEditMode()">
			<tr>
			<th colspan="7"></th>
		
			<th ng-repeat="property in outputContainerProperties track by $index">
						<input class="form-control input-sm" type="text"  
						ng-model="outputContainerValues[property.code]" 
						ng-change="updateAllOutputContainerProperty(property)"	
						udt-html-filter="number"							
						/>									
			</th>
			</tr>
			</tbody>
			
			<tbody ng-repeat="atm in atmService.data.atm | orderBy:'line' track by $index" ng-model="atm.inputContainerUseds" 
				droppable drop-fn="atmService.data.drop" 
				ng-switch="atmService.data.getATMViewMode(atm, $index)">
				
				<tr ng-switch-when="empty">
					<td>			
						<span class="label label-black" ng-bind="$index + 1"></span>
					</td>
					<td> 
						<button class="btn btn-default btn-xs"  ng-click="atmService.data.toggleATM($index)" ng-switch="atmService.data.atmViewOpen[$index]">
							<i ng-switch-when="true" class="fa fa-eye-slash"></i>
							<i ng-switch-when="false" class="fa fa-eye"></i>
						</button>			
					</td>
					<td colspan="{{5 + outputContainerProperties.length}}"></td>
				</tr>
				
				<tr ng-switch-when="compact" >	
					<td class="compactColumn">
						<span class="label label-black" ng-bind="$index + 1"></span>
					</td >
					<td class="compactColumn"> 					
						<button class="btn btn-default btn-xs"  ng-click="atmService.data.toggleATM($index)">
							<!--  i class="fa fa-eye-slash"></i-->
							<i class="fa fa-eye"></i>
						</button>			
					</td>	
					<td colspan="{{5 + outputContainerProperties.length}}" >
						<span ng-repeat="inputContainer in atm.inputContainerUseds | orderBy:'code' track by $index"  class="compactText"
							ng-model="inputContainer" draggable drag="dragInProgress">
							{{inputContainer.code}} / {{inputContainer.percentage}}% / PhiX:{{atm.outputContainerUseds[0].experimentProperties.phixPercent.value || "nr"}}%;<br/>
						</span>
					</td>
				</tr>
				
				<tr ng-switch-when="open" ng-repeat="inputContainer in atm.inputContainerUseds | orderBy:'code' track by $index"  
							ng-model="inputContainer" draggable drag="dragInProgress">	
						<td rowspan="{{atm.inputContainerUseds.length}}" ng-if="$index === 0">
							<span class="form-control-static label label-black" ng-bind="$parent.$parent.$index + 1"></span>
						</td>
						<td rowspan="{{atm.inputContainerUseds.length}}" ng-if="$index === 0">
							<button class="btn btn-default btn-xs"  ng-click="atmService.data.toggleATM($parent.$parent.$index)">
								<i class="fa fa-eye-slash"></i>
								<!-- i class="fa fa-eye"></i-->
							</button>			
						</td>			
						<td>							
							{{inputContainer.code}}
						</td>
						<td>
							<div ng-switch on="mainService.isEditMode()">						
								<span ng-switch-when="false" ng-bind="inputContainer.percentage"></span>						 
								<div ng-switch-when="true">
									<input class="form-control input-sm" type="text" 
										title='@Messages("containers.table.percentage")' 
										ng-model="inputContainer.percentage"
										ng-change="changeValueOnFlowcellDesign()" 
										udt-html-filter="number"/>								
								</div>
							</div>
						
						</td>
						<td>							
							<div list-resize="sampleAndTag in getSampleAndTags(inputContainer)" list-resize-min-size='2' below vertical></div>
						</td>
						<td>
							<div list-resize='inputContainer.contents | getArray:"sampleTypeCode"| unique | codes:"type"' list-resize-min-size='2' below vertical>
						</td> 
						<td>
							<div list-resize='inputContainer.contents | getArray:"properties.libProcessTypeCode.value"| unique ' list-resize-min-size='2' below vertical>
					
						</td>	
						<td ng-repeat="property in outputContainerProperties track by $index" 
							ng-if="$parent.$index === 0"
							rowspan="{{atm.inputContainerUseds.length}}">
								 
							<div ng-switch on="mainService.isEditMode()">						
								<span ng-switch-when="false" ng-bind="atm.outputContainerUseds[0].experimentProperties[property.code].value"></span>						 
								<div ng-switch-when="true">
									<input class="form-control input-sm" type="text" 
										 title="{{property.name}}"
										 ng-model="atm.outputContainerUseds[0].experimentProperties[property.code].value"
										 ng-change="changeValueOnFlowcellDesign(property)"
										 udt-html-filter="number" />		
							
								</div>
							</div>								 
								 				
						</td>											
					</tr>					
			</tbody>	
			</table>
		</div>
		
		</div>
	</div>
	<div class="tab-pane" id="roadmap">
	<div class="row roadmap">
		<div class="col-md-12 col-lg-12" ultimate-datatable="atmService.data.datatable"></div>
	</div>
	</div>
</div>
</div>

</div>